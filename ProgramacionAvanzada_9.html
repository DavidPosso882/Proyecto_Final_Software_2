<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Programación Avanzada | Guías y material de clase del espacio académico Programación Avanzada.</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Programación Avanzada" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Guías y material de clase del espacio académico Programación Avanzada." />
<meta property="og:description" content="Guías y material de clase del espacio académico Programación Avanzada." />
<link rel="canonical" href="https://caflorezvi.github.io/guias-programacion-avanzada/9.representacion-informacion.html" />
<meta property="og:url" content="https://caflorezvi.github.io/guias-programacion-avanzada/9.representacion-informacion.html" />
<meta property="og:site_name" content="Programación Avanzada" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Programación Avanzada" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Guías y material de clase del espacio académico Programación Avanzada.","headline":"Programación Avanzada","url":"https://caflorezvi.github.io/guias-programacion-avanzada/9.representacion-informacion.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/guias-programacion-avanzada/assets/css/style.css?v=12926fa7e43f9584a9f4f82f3d029693a64a6a39">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/guias-programacion-avanzada/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="https://caflorezvi.github.io/guias-programacion-avanzada/">Programación Avanzada</a></h1>
      

      <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Programa de Ingeniería de Sistemas y Computación
Universidad del Quindío

Título: Entidades para la Representación de Información
Duración estimada: 120
Docentes: Carlos Andrés Florez, Christian Andrés Candela
Guía: 09
</code></pre></div></div>
<hr />

<h1 id="entidades-para-la-representación-de-la-información">Entidades para la representación de la información</h1>

<h2 id="-objetivo">🎯 Objetivo</h2>

<p>Comprender el concepto de <strong>entidad</strong> en Spring Boot y su relación con las <strong>tablas</strong> en las bases de datos relacionales, aplicando buenas prácticas de modelado de datos para aplicaciones SQL.</p>

<hr />

<h2 id="conceptos-básicos">Conceptos Básicos</h2>

<ul>
  <li><strong>Base de datos</strong>: Conjunto de datos estructurados que se almacenan y gestionan de manera eficiente.</li>
  <li><strong>JSON</strong>: Formato de intercambio de datos ligero.</li>
  <li><strong>POO</strong>: Programación Orientada a Objetos en Java.</li>
  <li><strong>Spring Data JPA</strong>: Módulo de Spring para integración con bases de datos relacionales.</li>
  <li><strong>Java:</strong> Lenguaje de programación orientado a objetos.</li>
</ul>

<hr />

<h2 id="contextualización-teórica">Contextualización Teórica</h2>

<p>En el desarrollo de aplicaciones, es común que los datos generados y utilizados por la aplicación necesiten ser almacenados de manera permanente para su posterior recuperación y uso. Tradicionalmente, esto se ha logrado mediante bases de datos relacionales, en las cuales los datos se organizan en tablas con filas y columnas. Sin embargo, los lenguajes de programación orientados a objetos (OOP) como Java trabajan con estructuras de datos representadas mediante clases y objetos, lo que genera una disparidad entre la forma en que se almacenan y manipulan los datos en la aplicación y en la base de datos.</p>

<p>Para interactuar con bases de datos relacionales, los desarrolladores solían escribir consultas SQL manuales dentro del código de la aplicación, lo que llevaba a problemas como:</p>

<ul>
  <li><strong>Acoplamiento entre lógica de negocio y acceso a datos</strong>: La mezcla de SQL dentro del código hacía difícil la mantenibilidad y escalabilidad.</li>
  <li><strong>Errores comunes de seguridad</strong>: Como inyecciones SQL debido al uso inadecuado de concatenaciones de strings.</li>
  <li><strong>Inconsistencia en las consultas</strong>: Diferentes partes del código podían manejar la misma consulta de formas distintas.</li>
  <li><strong>Dificultad en la migración de bases de datos</strong>: Al cambiar de base de datos, se requería modificar todas las consultas SQL escritas manualmente.</li>
  <li><strong>Inconsistencia de datos</strong> al mapear objetos a tablas.</li>
  <li><strong>Acoplamiento</strong> entre lógica de negocio y acceso a datos.</li>
</ul>

<p>Para solucionar estos problemas, surgieron los frameworks de mapeo objeto-relacional (ORM) y los Object-Document Mapping (ODM), que permiten gestionar la persistencia de datos de manera transparente y eficiente.</p>

<h3 id="orm-object-relational-mapping">ORM (Object-Relational Mapping)</h3>

<p>El mapeo objeto-relacional (ORM, por sus siglas en inglés) es una técnica de programación que permite interactuar con bases de datos relacionales utilizando objetos en un lenguaje de programación orientado a objetos, como Java. ORM permite que los desarrolladores trabajen con estructuras de datos sin escribir directamente consultas SQL, ya que el framework ORM se encarga de traducir las operaciones de los objetos a comandos SQL subyacentes.</p>

<p>Los principales beneficios del uso de ORM incluyen:</p>

<ul>
  <li><strong>Abstracción del acceso a datos</strong>: Facilita la escritura y mantenimiento del código.</li>
  <li><strong>Reducción de errores</strong>: Al evitar SQL manual, se minimizan los errores comunes.</li>
  <li><strong>Compatibilidad con múltiples bases de datos</strong>: Permite cambiar de base de datos con menor esfuerzo.</li>
  <li><strong>Gestión de transacciones y caché</strong>: ORM maneja transacciones automáticamente y mejora el rendimiento mediante caché.</li>
</ul>

<p>Ejemplos populares de frameworks ORM en Java incluyen Hibernate (que implementa JPA), EclipseLink entre otros.</p>

<h3 id="jpa-java-persistence-api">JPA (Java Persistence API)</h3>

<p>JPA es una especificación de Java para la gestión de persistencia y mapeo objeto-relacional. No es una implementación en sí, sino un conjunto de reglas y anotaciones que permiten definir entidades y gestionar su almacenamiento en bases de datos relacionales. Hibernate es la implementación de JPA más utilizada en Java.</p>

<p>JPA proporciona diversas anotaciones para definir entidades, sus atributos y relaciones. A continuación, se presentan las más comunes:</p>

<p><strong>1. <code class="language-plaintext highlighter-rouge">@Entity</code></strong></p>

<p>Una entidad es un elemento de persistencia, que permite modelar o representar un objeto o información del sistema que estamos construyendo. Toda entidad está compuesta por uno o más atributos, cada uno de los cuales representa una propiedad o información del objeto que se está modelando.</p>

<p>La anotación <code class="language-plaintext highlighter-rouge">@Entity</code> se usa para marcar una clase como una entidad que se mapeará a una tabla en la base de datos.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jakarta.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">fullName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>2. <code class="language-plaintext highlighter-rouge">@Table</code></strong></p>

<p>Permite definir el nombre de la tabla en la base de datos. Si no se especifica, JPA utilizará el nombre de la clase como nombre de la tabla.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jakarta.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"users"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">fullName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>3. <code class="language-plaintext highlighter-rouge">@Id</code> y <code class="language-plaintext highlighter-rouge">@GeneratedValue</code></strong></p>

<p>Se usan para definir la clave primaria de la entidad y la estrategia de generación del identificador.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jakarta.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.GenerationType</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">fullName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>La anotación <code class="language-plaintext highlighter-rouge">@GeneratedValue</code> se utiliza para especificar cómo se generará el valor de la clave primaria. En este caso, se está utilizando la estrategia <code class="language-plaintext highlighter-rouge">IDENTITY</code>, que permite que la base de datos genere automáticamente el valor del identificador.</p>

<p><strong>4. <code class="language-plaintext highlighter-rouge">@Column</code></strong></p>

<p>Personaliza las propiedades de un atributo en la base de datos, como su nombre, restricciones y opciones de mapeo.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jakarta.persistence.Column</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"full_name"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">100</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">fullName</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>5. <code class="language-plaintext highlighter-rouge">@ManyToOne</code>, <code class="language-plaintext highlighter-rouge">@OneToMany</code>, <code class="language-plaintext highlighter-rouge">@OneToOne</code>, <code class="language-plaintext highlighter-rouge">@ManyToMany</code></strong></p>

<p>Estas anotaciones definen relaciones entre entidades. Por medio de estas anotaciones, se establecen las llaves foráneas y las relaciones de asociación entre las tablas en la base de datos.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="nd">@ManyToOne</span> <span class="c1">// Cada orden pertenece a un solo usuario. Este campo es la llave foránea.</span>
    <span class="kd">private</span> <span class="nc">User</span> <span class="n">user</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"user"</span><span class="o">)</span> <span class="c1">// Un usuario puede tener múltiples órdenes. Este campo no se mapea en la base de datos.</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">orders</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>En esta relación, un usuario puede tener múltiples órdenes, pero cada orden pertenece a un solo usuario. Otro aspecto importante es que las relaciones entre entidades pueden ser <strong>unidireccionales o bidireccionales</strong>. Para el ejemplo anterior, la relación es bidireccional porque ambas entidades (<code class="language-plaintext highlighter-rouge">User</code> y <code class="language-plaintext highlighter-rouge">Order</code>) tienen una referencia a la otra. Esto permite navegar desde un usuario a sus órdenes y viceversa.</p>

<p>Las relaciones bidireccionales son útiles cuando se necesita acceder a los datos desde ambos lados de la relación. Sin embargo, también pueden aumentar la complejidad del modelo y el rendimiento, por lo que es importante evaluar si realmente se necesita una relación bidireccional en cada caso.</p>

<hr />

<h2 id="precauciones-y-recomendaciones">Precauciones y Recomendaciones</h2>

<ul>
  <li>Recuerde verificar que tiene instalado el JDK de Java (preferiblemente la versión 21).</li>
  <li>Asegúrese tener el servidor de base de datos en ejecución.</li>
  <li>Se recomienda que primero se haga un <strong>diagrama de clases</strong> para visualizar la estructura de las entidades y sus relaciones.</li>
</ul>

<hr />

<h2 id="evaluación-o-resultado">Evaluación o Resultado</h2>

<p>Se espera que el estudiante logre modelar entidades lógicas de una aplicación y que por medio de ellas se generen las colecciones correspondientes en la base de datos que las representen de forma adecuada.</p>

<hr />

<h2 id="procedimiento">Procedimiento</h2>

<p>Continuaremos trabajando en el proyecto final del espacio académico que iniciamos en las guías anteriores. Si no ha completado la guía anterior, por favor hágalo antes de continuar con esta.</p>

<h3 id="1-configuración-inicial">1. Configuración inicial</h3>

<p>Agregue las siguientes dependencias en el archivo <code class="language-plaintext highlighter-rouge">build.gradle</code> para incluir Spring Data JPA y el conector de MariaDB:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">implementation</span> <span class="s1">'org.springframework.boot:spring-boot-starter-data-jpa'</span>
<span class="n">runtimeOnly</span> <span class="s1">'org.mariadb.jdbc:mariadb-java-client'</span>
</code></pre></div></div>

<p>Sincronice Gradle para que descargue la dependencia.</p>

<h3 id="2-modificar-archivo-applicationproperties">2. Modificar archivo <code class="language-plaintext highlighter-rouge">application.properties</code></h3>

<p>Agregue la siguiente configuración en el archivo <code class="language-plaintext highlighter-rouge">src/main/resources/application.properties</code>:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Configuración datasource
</span><span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:mariadb://localhost:3306/booking</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">root</span>
<span class="py">spring.datasource.password</span><span class="p">=</span><span class="s">su_contraseña</span>
<span class="py">spring.datasource.driver-class-name</span><span class="p">=</span><span class="s">org.mariadb.jdbc.Driver</span>

<span class="c"># Configuración JPA/Hibernate
</span><span class="py">spring.jpa.hibernate.ddl-auto</span><span class="p">=</span><span class="s">update</span>
<span class="py">spring.jpa.show-sql</span><span class="p">=</span><span class="s">true</span>
</code></pre></div></div>

<p>El archivo <code class="language-plaintext highlighter-rouge">application.properties</code> es fundamental en un proyecto de Spring. En este archivo se define la configuración de una aplicación, como por ejemplo, la conexión a la base de datos, el uso de modo debug para hacer un logging más detallado, entre otras cosas. Para conocer más sobre las propiedades que se pueden usar, podemos visitar <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html">la documentación oficial de Spring Boot</a>.</p>

<p>En nuestro caso, el archivo de propiedades, tiene los datos de conexión a la base de datos de MariaDB. Es decir, nos vamos a conectar a la base de datos con el nombre <code class="language-plaintext highlighter-rouge">booking</code> que está en el puerto <code class="language-plaintext highlighter-rouge">3306</code> (que es el puerto por defecto de MariaDB) en <code class="language-plaintext highlighter-rouge">localhost</code>.</p>

<blockquote>
  <p>⚠️ <strong>Importante:</strong> Puede cambiar el nombre de la base de datos, el usuario y la contraseña según su configuración.</p>
</blockquote>

<h3 id="3-crear-la-base-de-datos-en-mariadb">3. Crear la base de datos en MariaDB</h3>

<p>Para crear la base de datos en MariaDB, debe ingresar al cliente de MariaDB y ejecutar el siguiente comando:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">booking</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="4-crear-entidades">4. Crear Entidades</h3>

<p>A continuación, crearemos las entidades que representarán las tablas en nuestra base de datos. Ubíquese en la carpeta <code class="language-plaintext highlighter-rouge">main/java</code> y en el paquete <code class="language-plaintext highlighter-rouge">co.edu.uniquindio.application.model</code>, cree las siguientes clases:</p>

<h4 id="entidad-user">Entidad <code class="language-plaintext highlighter-rouge">User</code></h4>

<p>Si aún no la tiene, cree la clase <code class="language-plaintext highlighter-rouge">User</code> que representará a los usuarios de nuestra aplicación. Debe quedar así:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">co.edu.uniquindio.application.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">co.edu.uniquindio.application.model.enums.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">co.edu.uniquindio.application.model.enums.UserStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phone</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">photoUrl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">LocalDate</span> <span class="n">dateBirth</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdAt</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Role</span> <span class="n">role</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">UserStatus</span> <span class="n">status</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Se agrega la anotación <code class="language-plaintext highlighter-rouge">@Entity</code> para indicar que esta clase es una entidad de JPA. También se han agregado las anotaciones <code class="language-plaintext highlighter-rouge">@NoArgsConstructor</code> y <code class="language-plaintext highlighter-rouge">@AllArgsConstructor</code> para generar constructores sin argumentos y con todos los argumentos, respectivamente. Esto es útil para la creación de instancias de la entidad.</p>

<p>Además, es recomendable utilizar la anotación <code class="language-plaintext highlighter-rouge">@Builder</code> para facilitar la creación de instancias de la entidad de manera más legible y mantenible.</p>

<blockquote>
  <p>⚠️ <strong>Importante:</strong> Es obligatorio tener un constructor sin argumentos en las entidades de JPA. Esto lo logramos con la anotación <code class="language-plaintext highlighter-rouge">@NoArgsConstructor</code> de Lombok.</p>
</blockquote>

<p><strong>Restricciones de los campos:</strong></p>

<p>Es una buena práctica definir las restricciones de las propiedades de la entidad, como por ejemplo, la longitud máxima de un campo o si un campo es obligatorio, etc. Por ejemplo:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">co.edu.uniquindio.application.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">co.edu.uniquindio.application.model.enums.Role</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">co.edu.uniquindio.application.model.enums.UserStatus</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">15</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">phone</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">200</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">length</span> <span class="o">=</span> <span class="mi">200</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">photoUrl</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDate</span> <span class="n">dateBirth</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdAt</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Role</span> <span class="n">role</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">UserStatus</span> <span class="n">status</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Al mapear la entidad a la tabla <code class="language-plaintext highlighter-rouge">user</code>, se crearán en la base de datos las columnas correspondientes con las restricciones especificadas en las anotaciones <code class="language-plaintext highlighter-rouge">@Column</code>. En este caso, se han definido propiedades como <code class="language-plaintext highlighter-rouge">length</code>, para establecer la longitud máxima de los campos, y <code class="language-plaintext highlighter-rouge">nullable</code>, para indicar si un campo es obligatorio o puede quedar vacío.</p>

<p><strong>Uso de Enums</strong></p>

<p>Para los campos que tienen un conjunto limitado de valores, como <code class="language-plaintext highlighter-rouge">role</code> o <code class="language-plaintext highlighter-rouge">status</code>, es recomendable utilizar un <code class="language-plaintext highlighter-rouge">enum</code>. Esto ayuda a garantizar que solo se utilicen valores válidos para ese campo. JPA soporta el mapeo de enums a columnas de la base de datos.</p>

<p>Si un usuario puede tener múltiples roles, se podría utilizar una colección:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ElementCollection</span> <span class="c1">// Indica que es una colección de elementos básicos</span>
<span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Role</span><span class="o">&gt;</span> <span class="n">roles</span><span class="o">;</span>
</code></pre></div></div>

<h4 id="entidad-review">Entidad <code class="language-plaintext highlighter-rouge">Review</code></h4>

<p>La entidad <code class="language-plaintext highlighter-rouge">Review</code>, con sus campos y restricciones, puede quedar de la siguiente manera:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">co.edu.uniquindio.application.model</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">jakarta.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.time.LocalDateTime</span><span class="o">;</span>

<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Builder</span>
<span class="nd">@Getter</span> <span class="nd">@Setter</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Review</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span> <span class="c1">// Genera el id automáticamente en la base de datos</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span> <span class="c1">//Llave foránea a la entidad User</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">User</span> <span class="n">user</span><span class="o">;</span>

    <span class="nd">@Lob</span> <span class="c1">// Sirve para textos largos</span>
    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">comment</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">rating</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">createdAt</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div>

<p>El atributo <code class="language-plaintext highlighter-rouge">id</code> para esta entidad es de tipo <code class="language-plaintext highlighter-rouge">Long</code> y se genera automáticamente en la base de datos utilizando la estrategia <code class="language-plaintext highlighter-rouge">IDENTITY</code>. Esto implica que la base de datos se encargará de asignar un valor único a este campo cada vez que se cree una nueva reseña.</p>

<p>Como se mencionó anteriormente, las relaciones entre entidades deben definirse usando las anotaciones de JPA correspondientes. Por ejemplo:</p>

<ul>
  <li>Se usa la anotación <code class="language-plaintext highlighter-rouge">@ManyToOne</code> para establecer una relación de muchos a uno entre <code class="language-plaintext highlighter-rouge">Review</code> y <code class="language-plaintext highlighter-rouge">User</code>, lo que significa que un usuario puede hacer múltiples reseñas, pero una reseña solo puede pertenecer a un usuario.</li>
  <li>No se define la relación inversa en la entidad <code class="language-plaintext highlighter-rouge">User</code> para mantener la simplicidad y evitar complejidades innecesarias. Ya que <strong>no es necesario conocer las reseñas</strong> desde el usuario en este caso.</li>
</ul>

<p>Además, se usa la anotación <code class="language-plaintext highlighter-rouge">@JoinColumn</code> para especificar restricciones en la columna que representa la llave foránea.</p>

<h3 id="5-ejecución-del-proyecto">5. Ejecución del proyecto</h3>

<p>Ejecute la aplicación Spring Boot y verifique que no haya errores en la consola. Luego, vaya al cliente de MariaDB y verifique que las tablas se hayan creado correctamente.</p>

<h3 id="6-cree-la-entidad-place-y-sus-relaciones">6. Cree la entidad <code class="language-plaintext highlighter-rouge">Place</code> y sus relaciones</h3>

<p>Con base en la especificación del proyecto final, cree la entidad <code class="language-plaintext highlighter-rouge">Place</code> con sus respectivos atributos y relaciones. Tenga en cuenta lo siguiente:</p>

<ul>
  <li>La entidad <code class="language-plaintext highlighter-rouge">Review</code> debe tener una relación de muchos a uno (<code class="language-plaintext highlighter-rouge">@ManyToOne</code>) con la entidad <code class="language-plaintext highlighter-rouge">Place</code>, ya que un lugar puede tener múltiples reseñas, pero una reseña solo puede pertenecer a un lugar.</li>
  <li>La entidad <code class="language-plaintext highlighter-rouge">Place</code> debe tener una relación de uno a muchos (<code class="language-plaintext highlighter-rouge">@OneToMany</code>) con la entidad <code class="language-plaintext highlighter-rouge">Review</code>, ya que puede ser útil conocer las reseñas asociadas a un lugar. En este caso debe crear una lista de reseñas en la entidad <code class="language-plaintext highlighter-rouge">Place</code> y usar la propiedad <code class="language-plaintext highlighter-rouge">mappedBy</code> para indicar que la relación es bidireccional y que la entidad <code class="language-plaintext highlighter-rouge">Review</code> es la propietaria de la relación.</li>
</ul>

<p><strong>Ejemplo:</strong></p>

<p>La relación en la entidad <code class="language-plaintext highlighter-rouge">Review</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Review</span> <span class="o">{</span>
    <span class="c1">// Otros atributos...</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Place</span> <span class="n">place</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Y la relación inversa en la entidad <code class="language-plaintext highlighter-rouge">Place</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Place</span> <span class="o">{</span>
    <span class="c1">// Otros atributos...</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"place"</span><span class="o">)</span> <span class="c1">// Indica que la relación es bidireccional y que Review es la propietaria</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Review</span><span class="o">&gt;</span> <span class="n">reviews</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Identifique qué otras relaciones son necesarias en la entidad <code class="language-plaintext highlighter-rouge">Place</code> y defínalas adecuadamente.</p>

<h3 id="7-creación-de-las-entidades-del-proyecto-final">7. Creación de las entidades del proyecto final</h3>

<p>Cree todas las entidades necesarias para el proyecto final. Asegúrese de incluir las anotaciones adecuadas y de seguir las mejores prácticas de diseño de entidades.</p>

<h3 id="8-confirmar-cambios-en-git">8. Confirmar cambios en Git</h3>

<p>Recuerde agregar los archivos modificados y nuevos al repositorio de git y hacer commit.</p>

<hr />

<h2 id="para-la-próxima-clase">Para la próxima clase</h2>

<ul>
  <li>Revise la guía de Spring Data JPA en la documentación oficial: <a href="https://spring.io/projects/spring-data-jpa">Spring Data JPA</a>.</li>
  <li>Investigue sobre las diferentes estrategias de generación de claves primarias en JPA, como <code class="language-plaintext highlighter-rouge">IDENTITY</code>, <code class="language-plaintext highlighter-rouge">SEQUENCE</code>, <code class="language-plaintext highlighter-rouge">TABLE</code> y <code class="language-plaintext highlighter-rouge">AUTO</code>.</li>
  <li>Investigar sobre las anotaciones <code class="language-plaintext highlighter-rouge">@Embeddable</code> y <code class="language-plaintext highlighter-rouge">@Embedded</code> en JPA y cómo se utilizan para definir componentes embebidos en entidades.</li>
</ul>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
  </body>
</html>
